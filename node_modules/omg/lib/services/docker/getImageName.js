"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getImageName;

var _path = _interopRequireDefault(require("path"));

var _execa = _interopRequireDefault(require("execa"));

var _gitUrlParse = _interopRequireDefault(require("git-url-parse"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const REMOTE_REGEXP = /(?:\S+)\s+(\S+)\s+(?:\S+)/;

async function getImageName(options) {
  try {
    const {
      stdout
    } = await (0, _execa.default)('git', ['remote', '-v'], {
      cwd: _path.default.dirname(options.configPath)
    });
    const firstRemote = REMOTE_REGEXP.exec(stdout);

    if (firstRemote) {
      const parsed = (0, _gitUrlParse.default)(firstRemote[1]);

      if (parsed.full_name) {
        return {
          name: `omg/${parsed.full_name}`.toLowerCase(),
          generated: false
        };
      }
    }
  } catch (_) {
    /* No op */
  }

  const directoryHash = Buffer.from(process.cwd()).toString('base64').toLowerCase().replace(/=/g, '');
  return {
    name: `omg/${directoryHash}`.toLowerCase(),
    generated: true
  };
}