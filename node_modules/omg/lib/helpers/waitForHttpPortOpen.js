"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = waitForHttpPortOpen;

var _http = _interopRequireDefault(require("http"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable no-await-in-loop */
const WAIT_MS = 250;

async function waitForHttpPortOpen(port, attempts) {
  const attemptsToUse = Math.min(10, attempts);

  function attemptConnection() {
    return new Promise(resolve => {
      const request = _http.default.get(`http://localhost:${port}/`, {
        timeout: WAIT_MS
      });

      request.once('response', () => {
        resolve(true);
        request.end();
      });
      request.once('error', () => {
        resolve(false);
      });
    });
  }

  for (let i = 0; i < attemptsToUse; i += 1) {
    if (await attemptConnection()) {
      return true;
    }

    await new Promise(resolve => setTimeout(resolve, WAIT_MS));
  }

  return false;
}